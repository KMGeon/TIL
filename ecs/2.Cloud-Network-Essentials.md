# í´ë¼ìš°ë“œ ë„¤íŠ¸ì›Œí¬ ì™„ë²½ ê°€ì´ë“œ
## VPC, ë¡œë“œ ë°¸ëŸ°ì„œ, Security Group ì‹¬í™” ì´í•´

## ğŸ“Œ ê°œìš”

í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ë ¤ë©´ ë„¤íŠ¸ì›Œí¬ ê°œë…ì„ ì •í™•íˆ ì´í•´í•´ì•¼ í•œë‹¤. ì´ ë¬¸ì„œëŠ” AWSë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ VPC, ë¡œë“œ ë°¸ëŸ°ì„œ, Security Groupì˜ í•µì‹¬ ê°œë…ê³¼ ì‹¤ë¬´ ì ìš© ë°©ë²•ì„ ìƒì„¸íˆ ì„¤ëª…í•œë‹¤.

---

## ğŸŒ Part 1: VPC (Virtual Private Cloud)

### VPCë€ ë¬´ì—‡ì¸ê°€?

VPCëŠ” í´ë¼ìš°ë“œ ë‚´ì—ì„œ ë…¼ë¦¬ì ìœ¼ë¡œ ê²©ë¦¬ëœ ë„¤íŠ¸ì›Œí¬ ê³µê°„ì´ë‹¤. ë¬¼ë¦¬ì  ë°ì´í„°ì„¼í„°ì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ê°€ìƒí™”í•œ ê²ƒìœ¼ë¡œ, ì™„ì „í•œ ë„¤íŠ¸ì›Œí¬ ì œì–´ê¶Œì„ ì œê³µí•œë‹¤.

#### í•µì‹¬ ê°œë… ë¹„ìœ 
```
ë¬¼ë¦¬ ì„¸ê³„:          í´ë¼ìš°ë“œ ì„¸ê³„:
ê±´ë¬¼ = ë°ì´í„°ì„¼í„°    â†’  AWS ë¦¬ì „
ì¸µ = ì„œë²„ë™         â†’  ê°€ìš© ì˜ì—­(AZ)
ì‚¬ë¬´ì‹¤ = ì„œë²„       â†’  EC2 ì¸ìŠ¤í„´ìŠ¤
ì‚¬ë‚´ ë„¤íŠ¸ì›Œí¬       â†’  VPC
```

### VPC êµ¬ì¡°ì™€ êµ¬ì„± ìš”ì†Œ

#### 1. ê³„ì¸µ êµ¬ì¡°
```
AWS Account
â””â”€â”€ Region (ì˜ˆ: ap-northeast-2 ì„œìš¸)
    â””â”€â”€ VPC (ì˜ˆ: 10.0.0.0/16)
        â”œâ”€â”€ Availability Zone A
        â”‚   â”œâ”€â”€ Public Subnet (10.0.1.0/24)
        â”‚   â””â”€â”€ Private Subnet (10.0.101.0/24)
        â”œâ”€â”€ Availability Zone B
        â”‚   â”œâ”€â”€ Public Subnet (10.0.2.0/24)
        â”‚   â””â”€â”€ Private Subnet (10.0.102.0/24)
        â””â”€â”€ Availability Zone C
            â”œâ”€â”€ Public Subnet (10.0.3.0/24)
            â””â”€â”€ Private Subnet (10.0.103.0/24)
```

#### 2. CIDR ë¸”ë¡ ì´í•´
```bash
# VPC CIDR ì˜ˆì‹œ
10.0.0.0/16 = 10.0.0.0 ~ 10.0.255.255 (65,536ê°œ IP)

# ì„œë¸Œë„· ë¶„í• 
10.0.1.0/24 = 10.0.1.0 ~ 10.0.1.255 (256ê°œ IP)
10.0.2.0/24 = 10.0.2.0 ~ 10.0.2.255 (256ê°œ IP)

# ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥ IP (AWS ì˜ˆì•½ IP 5ê°œ ì œì™¸)
# x.x.x.0: ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ
# x.x.x.1: VPC ë¼ìš°í„°
# x.x.x.2: DNS ì„œë²„
# x.x.x.3: í–¥í›„ ì‚¬ìš© ì˜ˆì•½
# x.x.x.255: ë¸Œë¡œë“œìºìŠ¤íŠ¸
ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥: 251ê°œ
```

### ê°€ìš© ì˜ì—­(Availability Zone)ê³¼ ì„œë¸Œë„·

#### ê°€ìš© ì˜ì—­ì˜ ì˜ë¯¸
- **ë¬¼ë¦¬ì  ë¶„ë¦¬**: ê° AZëŠ” ë…ë¦½ëœ ì „ì›, ëƒ‰ê°, ë„¤íŠ¸ì›Œí¬ë¥¼ ê°€ì§„ ë°ì´í„°ì„¼í„°
- **ì§€ë¦¬ì  ë¶„ì‚°**: ê°™ì€ ë¦¬ì „ ë‚´ì—ì„œë„ ìˆ˜ km ~ ìˆ˜ì‹­ km ë–¨ì–´ì§„ ìœ„ì¹˜
- **ê³ ê°€ìš©ì„±**: í•œ AZ ì¥ì•  ì‹œì—ë„ ë‹¤ë¥¸ AZì—ì„œ ì„œë¹„ìŠ¤ ì§€ì†

#### ì„œë¸Œë„· ì„¤ê³„ íŒ¨í„´

##### 1. ê¸°ë³¸ 3-Tier ì•„í‚¤í…ì²˜
```yaml
# Public Subnet: ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ì™€ ì—°ê²°
- ìš©ë„: ë¡œë“œ ë°¸ëŸ°ì„œ, NAT ê²Œì´íŠ¸ì›¨ì´, Bastion í˜¸ìŠ¤íŠ¸
- ë¼ìš°íŒ…: 0.0.0.0/0 â†’ Internet Gateway

# Private Subnet: ì¸í„°ë„· ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
- ìš©ë„: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„, ì»¨í…Œì´ë„ˆ
- ë¼ìš°íŒ…: 0.0.0.0/0 â†’ NAT Gateway

# Database Subnet: ê°€ì¥ ì œí•œì ì¸ ì ‘ê·¼
- ìš©ë„: RDS, ElastiCache
- ë¼ìš°íŒ…: VPC ë‚´ë¶€ë§Œ í—ˆìš©
```

##### 2. ì‹¤ì œ êµ¬í˜„ ì˜ˆì œ
```bash
# AWS CLIë¡œ VPC ìƒì„±
aws ec2 create-vpc \
    --cidr-block 10.0.0.0/16 \
    --tag-specifications 'ResourceType=vpc,Tags=[{Key=Name,Value=MyVPC}]'

# ì„œë¸Œë„· ìƒì„± (ê° AZë³„ë¡œ)
aws ec2 create-subnet \
    --vpc-id vpc-xxxxx \
    --cidr-block 10.0.1.0/24 \
    --availability-zone ap-northeast-2a \
    --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=Public-2a}]'
```

### VPC ê³ ê¸‰ ê¸°ëŠ¥

#### 1. VPC Peering
```bash
# ë‹¤ë¥¸ VPCì™€ ì—°ê²°
aws ec2 create-vpc-peering-connection \
    --vpc-id vpc-aaaaa \
    --peer-vpc-id vpc-bbbbb
    
# íŠ¹ì§•:
# - ë‹¤ë¥¸ ê³„ì •, ë‹¤ë¥¸ ë¦¬ì „ VPCì™€ë„ ì—°ê²° ê°€ëŠ¥
# - ì „ì´ì  ë¼ìš°íŒ… ë¶ˆê°€ (A-B, B-C ì—°ê²°ì´ì–´ë„ A-C ì§ì ‘ í†µì‹  ë¶ˆê°€)
# - 1:1 ì—°ê²°ë§Œ ê°€ëŠ¥
```

#### 2. VPC Endpoint
```yaml
# S3 VPC Endpoint ì„¤ì • (ì¸í„°ë„· ê±°ì¹˜ì§€ ì•Šê³  S3 ì ‘ê·¼)
Type: AWS::EC2::VPCEndpoint
Properties:
  VpcId: !Ref VPC
  ServiceName: com.amazonaws.ap-northeast-2.s3
  RouteTableIds:
    - !Ref PrivateRouteTable
```

#### 3. Transit Gateway
```
ì¤‘ì•™ í—ˆë¸Œ ì—­í• :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPC 1  â”‚â”€â”€â”€â”€â”‚ Transit  â”‚â”€â”€â”€â”€â”‚  VPC 3  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Gateway  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPC 2  â”‚â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”‚On-Premiseâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš–ï¸ Part 2: ë¡œë“œ ë°¸ëŸ°ì„œ ì‹¬í™” ì´í•´

### ë¡œë“œ ë°¸ëŸ°ì„œ ì¢…ë¥˜ì™€ ì„ íƒ

#### 1. Application Load Balancer (ALB)
```yaml
íŠ¹ì§•:
- Layer 7 (HTTP/HTTPS)
- ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ…
- í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ…
- WebSocket ì§€ì›
- HTTP/2 ì§€ì›

ì‚¬ìš© ì‚¬ë¡€:
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
- ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜
- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
```

#### 2. Network Load Balancer (NLB)
```yaml
íŠ¹ì§•:
- Layer 4 (TCP/UDP)
- ì´ˆê³ ì† ì„±ëŠ¥ (ìˆ˜ë°±ë§Œ RPS)
- ê³ ì • IP ì§€ì›
- ì†ŒìŠ¤ IP ë³´ì¡´

ì‚¬ìš© ì‚¬ë¡€:
- ê²Œì„ ì„œë²„
- IoT ì• í”Œë¦¬ì¼€ì´ì…˜
- ê¸ˆìœµ ê±°ë˜ ì‹œìŠ¤í…œ
```

#### 3. Classic Load Balancer (CLB)
```yaml
íŠ¹ì§•:
- ë ˆê±°ì‹œ (ì‹ ê·œ ì‚¬ìš© ë¹„ì¶”ì²œ)
- Layer 4/7 í˜¼í•©
- EC2-Classic ì§€ì›

ë§ˆì´ê·¸ë ˆì´ì…˜ ê¶Œì¥:
CLB â†’ ALB or NLB
```

### ë¦¬ìŠ¤ë„ˆ ê·œì¹™ (Listener Rules) ìƒì„¸

#### ê·œì¹™ ìš°ì„ ìˆœìœ„ì™€ ì²˜ë¦¬
```json
{
  "Rules": [
    {
      "Priority": 1,
      "Conditions": [
        {
          "Field": "host-header",
          "Values": ["api.example.com"]
        }
      ],
      "Actions": [
        {
          "Type": "forward",
          "TargetGroupArn": "arn:aws:elasticloadbalancing:..."
        }
      ]
    },
    {
      "Priority": 2,
      "Conditions": [
        {
          "Field": "path-pattern",
          "Values": ["/admin/*"]
        }
      ],
      "Actions": [
        {
          "Type": "authenticate-cognito",
          "AuthenticateCognitoConfig": {
            "UserPoolArn": "arn:aws:cognito-idp:..."
          }
        },
        {
          "Type": "forward",
          "TargetGroupArn": "arn:aws:elasticloadbalancing:..."
        }
      ]
    }
  ]
}
```

#### ê³ ê¸‰ ë¼ìš°íŒ… íŒ¨í„´

##### 1. ê°€ì¤‘ì¹˜ ê¸°ë°˜ ë¼ìš°íŒ…
```yaml
# Blue-Green ë°°í¬ë‚˜ A/B í…ŒìŠ¤íŠ¸ì— í™œìš©
Actions:
  - Type: forward
    ForwardConfig:
      TargetGroups:
        - TargetGroupArn: !Ref BlueTargetGroup
          Weight: 80
        - TargetGroupArn: !Ref GreenTargetGroup
          Weight: 20
```

##### 2. ì¡°ê±´ë¶€ ë¼ìš°íŒ…
```python
# ë‹¤ì–‘í•œ ì¡°ê±´ ì¡°í•©
conditions = [
    {
        "Field": "http-request-method",
        "HttpRequestMethodConfig": {
            "Values": ["POST", "PUT"]
        }
    },
    {
        "Field": "http-header",
        "HttpHeaderConfig": {
            "HeaderName": "X-Custom-Header",
            "Values": ["value1", "value2"]
        }
    },
    {
        "Field": "source-ip",
        "SourceIpConfig": {
            "Values": ["192.168.1.0/24"]
        }
    }
]
```

### íƒ€ê²Ÿ ê·¸ë£¹ (Target Groups) ê´€ë¦¬

#### í—¬ìŠ¤ ì²´í¬ ì„¤ì •
```yaml
HealthCheck:
  Protocol: HTTP
  Path: /health
  Port: traffic-port
  HealthyThresholdCount: 2      # ì—°ì† ì„±ê³µ íšŸìˆ˜
  UnhealthyThresholdCount: 3    # ì—°ì† ì‹¤íŒ¨ íšŸìˆ˜
  TimeoutSeconds: 5              # ì‘ë‹µ ëŒ€ê¸° ì‹œê°„
  IntervalSeconds: 30            # ì²´í¬ ê°„ê²©
  Matcher:
    HttpCode: 200-299           # ì„±ê³µìœ¼ë¡œ ê°„ì£¼í•  HTTP ì½”ë“œ
```

#### íƒ€ê²Ÿ ì¢…ë¥˜
```yaml
# 1. Instance (EC2)
Targets:
  - Id: i-1234567890abcdef0
    Port: 80

# 2. IP (Fargate, ì˜¨í”„ë ˆë¯¸ìŠ¤)
Targets:
  - Id: 10.0.1.100
    Port: 8080
    
# 3. Lambda
Targets:
  - Id: arn:aws:lambda:region:account:function:my-function
```

#### Connection Draining (ë“±ë¡ í•´ì œ ì§€ì—°)
```bash
# íƒ€ê²Ÿ ì œê±° ì‹œ ê¸°ì¡´ ì—°ê²° ì²˜ë¦¬
aws elbv2 modify-target-group-attributes \
    --target-group-arn arn:aws:elasticloadbalancing:... \
    --attributes Key=deregistration_delay.timeout_seconds,Value=30
```

### ë¡œë“œ ë°¸ëŸ°ì„œ ì„±ëŠ¥ ìµœì í™”

#### 1. Cross-Zone Load Balancing
```
í™œì„±í™” ì „:
AZ-A: LB â†’ [Instance1(50%), Instance2(50%)]
AZ-B: LB â†’ [Instance3(100%)]
ê²°ê³¼: ë¶ˆê· ë“± ë¶„ì‚°

í™œì„±í™” í›„:
ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ê°€ 33.33%ì”© ê· ë“± ë¶„ì‚°
```

#### 2. Sticky Sessions
```yaml
# ì„¸ì…˜ ìœ ì§€ ì„¤ì •
TargetGroupAttributes:
  - Key: stickiness.enabled
    Value: true
  - Key: stickiness.type
    Value: app_cookie
  - Key: stickiness.app_cookie.cookie_name
    Value: SESSIONID
  - Key: stickiness.app_cookie.duration_seconds
    Value: 86400
```

---

## ğŸ”’ Part 3: Security Group ì™„ë²½ ê°€ì´ë“œ

### Security Group í•µì‹¬ ì´í•´

#### ê¸°ë³¸ íŠ¹ì„±
```yaml
íŠ¹ì§•:
- Stateful: ë‚˜ê°€ëŠ” íŠ¸ë˜í”½ì— ëŒ€í•œ ì‘ë‹µì€ ìë™ í—ˆìš©
- ê¸°ë³¸ ê±°ë¶€: ëª…ì‹œì  í—ˆìš©ë§Œ ê°€ëŠ¥ (ê±°ë¶€ ê·œì¹™ ì—†ìŒ)
- ì¸ìŠ¤í„´ìŠ¤ ë ˆë²¨: ê° ENI(Elastic Network Interface)ì— ì ìš©
- ë‹¤ì¤‘ ì ìš©: í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ì— ìµœëŒ€ 5ê°œ SG ì ìš© ê°€ëŠ¥
```

### ì¸ë°”ìš´ë“œ/ì•„ì›ƒë°”ìš´ë“œ ê·œì¹™ ìƒì„¸

#### 1. ê·œì¹™ êµ¬ì¡°
```json
{
  "IpProtocol": "tcp",
  "FromPort": 443,
  "ToPort": 443,
  "IpRanges": [
    {
      "CidrIp": "0.0.0.0/0",
      "Description": "HTTPS from anywhere"
    }
  ],
  "Ipv6Ranges": [
    {
      "CidrIpv6": "::/0",
      "Description": "HTTPS from anywhere IPv6"
    }
  ],
  "UserIdGroupPairs": [
    {
      "GroupId": "sg-123456",
      "Description": "From Load Balancer SG"
    }
  ]
}
```

#### 2. í”„ë¡œí† ì½œë³„ ì„¤ì • ì˜ˆì‹œ

##### HTTP/HTTPS ì›¹ ì„œë²„
```bash
# ì¸ë°”ìš´ë“œ
aws ec2 authorize-security-group-ingress \
    --group-id sg-xxxxx \
    --protocol tcp \
    --port 443 \
    --cidr 0.0.0.0/0

# ì•„ì›ƒë°”ìš´ë“œ (ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë‘ í—ˆìš©)
# DNS, ì‹œê°„ ë™ê¸°í™”, íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ë“±ì„ ìœ„í•´
```

##### ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„
```bash
# PostgreSQL - ì•± ì„œë²„ SGì—ì„œë§Œ ì ‘ê·¼
aws ec2 authorize-security-group-ingress \
    --group-id sg-db-xxxxx \
    --protocol tcp \
    --port 5432 \
    --source-group sg-app-xxxxx
```

##### SSH/RDP ê´€ë¦¬ ì ‘ê·¼
```bash
# Bastion í˜¸ìŠ¤íŠ¸ë‚˜ íŠ¹ì • IPì—ì„œë§Œ
aws ec2 authorize-security-group-ingress \
    --group-id sg-xxxxx \
    --protocol tcp \
    --port 22 \
    --cidr 203.0.113.0/32  # íŠ¹ì • IPë§Œ
```

### ë³´ì•ˆ ê·¸ë£¹ ì„¤ê³„ íŒ¨í„´

#### 1. ê³„ì¸µë³„ ë³´ì•ˆ ê·¸ë£¹ êµ¬ì„±
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ì¸í„°ë„·                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ALB SG           â”‚
    â”‚   In: 0.0.0.0/0:443â”‚
    â”‚   Out: App-SG:8080 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   App SG           â”‚
    â”‚   In: ALB-SG:8080  â”‚
    â”‚   Out: DB-SG:5432  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   DB SG            â”‚
    â”‚   In: App-SG:5432  â”‚
    â”‚   Out: None        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë³´ì•ˆ ê·¸ë£¹
```yaml
# ì„œë¹„ìŠ¤ ê°„ í†µì‹  ì œì–´
UserService-SG:
  Inbound:
    - From: Gateway-SG, Port: 8080
    
OrderService-SG:
  Inbound:
    - From: Gateway-SG, Port: 8081
    - From: UserService-SG, Port: 8081
    
PaymentService-SG:
  Inbound:
    - From: OrderService-SG, Port: 8082
```

### ë””í´íŠ¸ ë³´ì•ˆ ê·¸ë£¹ì˜ í•¨ì •ê³¼ ëŒ€ì‘

#### ë¬¸ì œ ìƒí™©
```bash
# ì˜ëª»ëœ ì„¤ì • (ë³´ì•ˆ ìœ„í—˜!)
aws ec2 authorize-security-group-ingress \
    --group-id sg-default \
    --protocol -1 \
    --port -1 \
    --cidr 0.0.0.0/0
    
# ê²°ê³¼: ëª¨ë“  í¬íŠ¸ê°€ ì¸í„°ë„·ì— ë…¸ì¶œ
```

#### ì˜¬ë°”ë¥¸ ì ‘ê·¼
```bash
# 1. ì—­í• ë³„ ë³´ì•ˆ ê·¸ë£¹ ìƒì„±
aws ec2 create-security-group \
    --group-name web-servers \
    --description "Security group for web servers"

# 2. ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©
aws ec2 authorize-security-group-ingress \
    --group-id sg-web \
    --protocol tcp \
    --port 443 \
    --cidr 0.0.0.0/0

# 3. ë””í´íŠ¸ SGëŠ” ë‚´ë¶€ í†µì‹ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©
```

### ì‹¤ì „ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### 1. ì •ê¸° ê°ì‚¬ ìŠ¤í¬ë¦½íŠ¸
```python
import boto3

def audit_security_groups():
    ec2 = boto3.client('ec2')
    
    # ìœ„í—˜í•œ ê·œì¹™ ì°¾ê¸°
    dangerous_rules = []
    
    response = ec2.describe_security_groups()
    
    for sg in response['SecurityGroups']:
        for rule in sg['IpPermissions']:
            # 0.0.0.0/0ì—ì„œ SSH/RDP í—ˆìš© ì²´í¬
            if rule.get('FromPort') in [22, 3389]:
                for ip_range in rule.get('IpRanges', []):
                    if ip_range.get('CidrIp') == '0.0.0.0/0':
                        dangerous_rules.append({
                            'GroupId': sg['GroupId'],
                            'Port': rule['FromPort'],
                            'Risk': 'HIGH - Management port open to internet'
                        })
    
    return dangerous_rules
```

#### 2. ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬ ì „ëµ
```yaml
# Production í™˜ê²½
Production-VPC:
  CIDR: 10.0.0.0/16
  SecurityGroups:
    - Prod-Web-SG
    - Prod-App-SG
    - Prod-DB-SG
  NetworkACLs: Restrictive

# Development í™˜ê²½ (ì™„ì „ ë¶„ë¦¬)
Development-VPC:
  CIDR: 10.1.0.0/16
  SecurityGroups:
    - Dev-Web-SG
    - Dev-App-SG
    - Dev-DB-SG
  NetworkACLs: Permissive

# VPC Peeringìœ¼ë¡œ í•„ìš”ì‹œë§Œ ì—°ê²°
```

---

## ğŸš€ ì‹¤ì „ ì ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ECS Fargate ë°°í¬
```yaml
# 1. VPC êµ¬ì„±
VPC: 10.0.0.0/16
â”œâ”€â”€ Public Subnet (ALB): 10.0.1.0/24, 10.0.2.0/24
â””â”€â”€ Private Subnet (ECS): 10.0.101.0/24, 10.0.102.0/24

# 2. Security Group êµ¬ì„±
ALB-SG:
  Inbound: 0.0.0.0/0:443
  Outbound: ECS-SG:8080

ECS-SG:
  Inbound: ALB-SG:8080
  Outbound: 0.0.0.0/0:443 (ì™¸ë¶€ API í˜¸ì¶œìš©)

# 3. ë¡œë“œ ë°¸ëŸ°ì„œ ì„¤ì •
ALB:
  Listener: HTTPS:443
  Target Group: ECS Tasks (IP targets)
  Health Check: /health
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë©€í‹° í‹°ì–´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
```bash
# Terraformìœ¼ë¡œ êµ¬ì„±
resource "aws_vpc" "main" {
  cidr_block = "10.0.0.0/16"
  
  enable_dns_hostnames = true
  enable_dns_support = true
}

resource "aws_subnet" "public" {
  count = 2
  vpc_id = aws_vpc.main.id
  cidr_block = "10.0.${count.index + 1}.0/24"
  availability_zone = data.aws_availability_zones.available.names[count.index]
  map_public_ip_on_launch = true
}

resource "aws_security_group" "alb" {
  name = "alb-security-group"
  vpc_id = aws_vpc.main.id
  
  ingress {
    from_port = 443
    to_port = 443
    protocol = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
  
  egress {
    from_port = 0
    to_port = 0
    protocol = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬
```yaml
# ëª¨ë“  í†µì‹  ì•”í˜¸í™” ë° ì¸ì¦
Service Mesh (Istio):
  mTLS: enabled
  Authorization Policies: strict
  
Network Policies:
  Default: Deny All
  Explicit Allow: Per Service
  
WAF Rules:
  SQL Injection: Block
  XSS: Block
  Rate Limiting: 1000 req/min
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§ê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### VPC Flow Logs ë¶„ì„
```python
# Flow Logs íŒŒì‹± ì˜ˆì œ
import pandas as pd

def analyze_flow_logs(log_file):
    # Flow Log í¬ë§·
    columns = ['version', 'account', 'interface', 'srcaddr', 
               'dstaddr', 'srcport', 'dstport', 'protocol', 
               'packets', 'bytes', 'start', 'end', 'action', 'log_status']
    
    df = pd.read_csv(log_file, sep=' ', names=columns)
    
    # ê±°ë¶€ëœ íŠ¸ë˜í”½ ë¶„ì„
    rejected = df[df['action'] == 'REJECT']
    
    # Top 10 ì°¨ë‹¨ëœ ì†ŒìŠ¤ IP
    top_blocked = rejected['srcaddr'].value_counts().head(10)
    
    return {
        'total_rejected': len(rejected),
        'top_blocked_ips': top_blocked.to_dict()
    }
```

### ë¡œë“œ ë°¸ëŸ°ì„œ ë©”íŠ¸ë¦­
```bash
# CloudWatch ë©”íŠ¸ë¦­ í™•ì¸
aws cloudwatch get-metric-statistics \
    --namespace AWS/ApplicationELB \
    --metric-name TargetResponseTime \
    --dimensions Name=LoadBalancer,Value=app/my-alb/xxxxx \
    --start-time 2024-01-01T00:00:00Z \
    --end-time 2024-01-01T23:59:59Z \
    --period 300 \
    --statistics Average
```

### Security Group ë³€ê²½ ì¶”ì 
```python
# CloudTrail ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§
import boto3

def track_sg_changes():
    cloudtrail = boto3.client('cloudtrail')
    
    response = cloudtrail.lookup_events(
        LookupAttributes=[
            {
                'AttributeKey': 'EventName',
                'AttributeValue': 'AuthorizeSecurityGroupIngress'
            }
        ],
        MaxResults=50
    )
    
    for event in response['Events']:
        print(f"Time: {event['EventTime']}")
        print(f"User: {event['Username']}")
        print(f"SG: {event['Resources'][0]['ResourceName']}")
```

---

## ğŸ¯ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ì´ì •ë¦¬

### VPC ì„¤ê³„ ì›ì¹™
1. **IP ëŒ€ì—­ ê³„íš**: ì¶©ë¶„í•œ ì—¬ìœ ë¥¼ ë‘ê³  CIDR ë¸”ë¡ í• ë‹¹
2. **ì„œë¸Œë„· ë¶„ë¦¬**: Public/Private/Database ë ˆì´ì–´ ëª…í™•íˆ êµ¬ë¶„
3. **ë©€í‹° AZ**: ìµœì†Œ 2ê°œ ì´ìƒì˜ AZ ì‚¬ìš©
4. **VPC Endpoint**: AWS ì„œë¹„ìŠ¤ ì ‘ê·¼ ì‹œ ì¸í„°ë„· ê²½ìœ  ìµœì†Œí™”

### ë¡œë“œ ë°¸ëŸ°ì„œ ìš´ì˜
1. **í—¬ìŠ¤ì²´í¬ íŠœë‹**: ì„œë¹„ìŠ¤ íŠ¹ì„±ì— ë§ê²Œ ì¡°ì •
2. **Connection Draining**: 30-60ì´ˆ ì„¤ì •ìœ¼ë¡œ graceful shutdown
3. **Access Logs**: S3ì— ì €ì¥í•˜ì—¬ ë¶„ì„
4. **SSL/TLS**: ìµœì‹  ì •ì±… ì‚¬ìš©, SSL Labs A+ ë“±ê¸‰ ìœ ì§€

### Security Group ê´€ë¦¬
1. **ìµœì†Œ ê¶Œí•œ ì›ì¹™**: í•„ìš”í•œ í¬íŠ¸ì™€ ì†ŒìŠ¤ë§Œ í—ˆìš©
2. **ì„¤ëª… í•„ìˆ˜**: ëª¨ë“  ê·œì¹™ì— ëª…í™•í•œ ì„¤ëª… ì¶”ê°€
3. **ì •ê¸° ê°ì‚¬**: ìë™í™”ëœ ìŠ¤í¬ë¦½íŠ¸ë¡œ ìœ„í—˜ ê·œì¹™ íƒì§€
4. **ë³€ê²½ ê´€ë¦¬**: Terraform/CloudFormationìœ¼ë¡œ ì½”ë“œí™”

---

## ğŸ’¡ ì‹¤ë¬´ íŒ

### ë¹„ìš© ìµœì í™”
```yaml
# NAT Gateway ë¹„ìš© ì ˆê°
ë‹¨ì¼ NAT: 
  - ê°œë°œ í™˜ê²½
  - ë¹„ìš©: $45/ì›”

ë‹¤ì¤‘ NAT (HA):
  - í”„ë¡œë•ì…˜ í™˜ê²½
  - ë¹„ìš©: $135/ì›” (3 AZ)

# VPC Endpointë¡œ ë°ì´í„° ì „ì†¡ ë¹„ìš© ì ˆê°
S3 Transfer:
  - Internet Gateway: $0.09/GB
  - VPC Endpoint: $0.01/GB
```

### ì„±ëŠ¥ ìµœì í™”
```yaml
# Network ì„±ëŠ¥ í–¥ìƒ
Enhanced Networking: 
  - SR-IOV í™œì„±í™”
  - ìµœëŒ€ 100 Gbps

Placement Groups:
  - Cluster: ë‚®ì€ ì§€ì—° ì‹œê°„
  - Spread: ê³ ê°€ìš©ì„±
  - Partition: ëŒ€ê·œëª¨ ë¶„ì‚° ì›Œí¬ë¡œë“œ
```

### ë³´ì•ˆ ê°•í™”
```bash
# AWS Systems Manager Session Manager
# Bastion í˜¸ìŠ¤íŠ¸ ì—†ì´ ì•ˆì „í•œ ì ‘ê·¼
aws ssm start-session --target i-1234567890abcdef0

# VPC Endpoint for SSM ì„¤ì • í•„ìš”
- com.amazonaws.region.ssm
- com.amazonaws.region.ec2messages
- com.amazonaws.region.ssmmessages
```

---

## ğŸ¬ ê²°ë¡ 

í´ë¼ìš°ë“œ ë„¤íŠ¸ì›Œí¬ì˜ ì„¸ ê°€ì§€ í•µì‹¬ ìš”ì†Œì¸ VPC, ë¡œë“œ ë°¸ëŸ°ì„œ, Security Groupì„ ì œëŒ€ë¡œ ì´í•´í•˜ê³  êµ¬ì„±í•˜ëŠ” ê²ƒì€ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ì¸í”„ë¼ì˜ ê¸°ì´ˆë‹¤.

### í•µì‹¬ í¬ì¸íŠ¸
1. **VPCëŠ” ê²©ë¦¬ì˜ ê¸°ë³¸**: ë„¤íŠ¸ì›Œí¬ ë ˆë²¨ì—ì„œ ì²« ë²ˆì§¸ ë°©ì–´ì„ 
2. **ë¡œë“œ ë°¸ëŸ°ì„œëŠ” ê°€ìš©ì„±ì˜ í•µì‹¬**: íŠ¸ë˜í”½ ë¶„ì‚°ê³¼ í—¬ìŠ¤ì²´í¬ë¡œ ì•ˆì •ì„± í™•ë³´
3. **Security Groupì€ ìµœí›„ì˜ ë°©ì–´ì„ **: ì¸ìŠ¤í„´ìŠ¤ ë ˆë²¨ì—ì„œ ì •ë°€í•œ ì œì–´

### ë‹¤ìŒ ë‹¨ê³„
- ì‹¤ì œ í™˜ê²½ì— ì ìš©í•˜ë©° ê²½í—˜ ì¶•ì 
- ìë™í™” ë„êµ¬ (Terraform, CDK) í™œìš©
- ëª¨ë‹ˆí„°ë§ê³¼ ì•Œë¦¼ ì²´ê³„ êµ¬ì¶•
- ì •ê¸°ì ì¸ ë³´ì•ˆ ê°ì‚¬ ì‹¤ì‹œ

ê¸°ì´ˆë¥¼ íƒ„íƒ„íˆ ë‹¤ì§„ í›„, ì ì§„ì ìœ¼ë¡œ ê³ ê¸‰ ê¸°ëŠ¥ì„ ë„ì…í•˜ëŠ” ê²ƒì´ ì•ˆì •ì ì¸ í´ë¼ìš°ë“œ ì¸í”„ë¼ êµ¬ì¶•ì˜ ì§€ë¦„ê¸¸ì´ë‹¤.