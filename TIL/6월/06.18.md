# [ 0618 ] TIL

--- 

- [x] [Spring Batch Flow]

---

## ëª©ì°¨

---

1. [Flow](https://www.notion.so/5-Flow-a3372cf707124425bd9e887cd7c4d08b?pvs=21)
2. [Transition](https://www.notion.so/5-Flow-a3372cf707124425bd9e887cd7c4d08b?pvs=21)
3. [ExitStatus](https://www.notion.so/5-Flow-a3372cf707124425bd9e887cd7c4d08b?pvs=21)
4. [JobExecutionDecider](https://www.notion.so/5-Flow-a3372cf707124425bd9e887cd7c4d08b?pvs=21)
5. [FlowJob](https://www.notion.so/5-Flow-a3372cf707124425bd9e887cd7c4d08b?pvs=21)
6. [@JobScope / @StepScope](https://www.notion.so/5-Flow-a3372cf707124425bd9e887cd7c4d08b?pvs=21)

# 1. Flow

- Stepì„ ìˆœì°¨ì ìœ¼ë¡œë§Œ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ íŠ¹ì •í•œ ìƒíƒœì— ë”°ë¼ íë¦„ì„ ì „í™˜í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.
    - Stepì´ ì‹¤íŒ¨ë¥¼ í•˜ë”ë¼ë„  Jobì€ ì‹¤íŒ¨ë¡œ ëë‚˜ì§€ ì•Šë„ë¡ í•´ì•¼ í•˜ëŠ” ê²½ìš°
    - Stepì´ ì„±ê³µ í–ˆì„ ë•Œ ë‹¤ìŒì— ì‹¤í–‰í•´ì•¼ í•  Stepì„ êµ¬ë¶„í•´ì„œ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” ê²½ìš°
    - íŠ¹ì • Stepì€ ì „í˜€ ì‹¤í–‰ë˜ì§€ ì•Šê²Œ êµ¬ì„± í•´ì•¼ í•˜ëŠ” ê²½ìš°

- Flow, Jobì€ íë¦„ì„ êµ¬ì„±í•˜ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ Stepì—ì„œ ì´ë£¨ì–´ì§„ë‹¤.
    - ë‚´ë¶€ì ìœ¼ë¡œ SimpleFlow ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆì–´  Job ì‹¤í–‰ ì‹œ í˜¸ì¶œí•œë‹¤.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/fb644bcd-1722-4457-a468-ba92a1900c12/Untitled.png)

- SImpleJobì€ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì‹¤íŒ¨í•˜ì§€ë§Œ FlowëŠ” ì´ê²ƒì„ ë¶„ê¸°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```java
ìˆœì„œ 
JobBuilder > JobFlowBuilder > FlowBuilder > FlowJob

on : stepì˜ ì‹¤í–‰ìƒíƒœë¥¼ ê°€ì ¸ì™€, TrasnsitionBuilder ë°˜í™˜

stop, fail, end, stopandrestrtê°€ í˜¸ì¶œë˜ë©´ ê²°êµ­ì—ëŠ” flow ì¢…ë£Œ / jobì´ ì¢…ë£Œ ì•„ë‹˜

from : ì´ì „ ë‹¨ê³„ì— ì •ì˜í•œ step
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/97426282-294a-4fc6-9600-3d32538462a9/Untitled.png)

- start, from, next : flowì˜ íë¦„ì„ ì •ì˜í•˜ëŠ” ì—­í™œ
- on, to, stop, fail : íŠ¸ëœì­ì…˜ : ì¡°ê±´ì— ë”°ë¼ íë¦„ì„ ì „í™”í•˜ëŠ” ì—­í™œ

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/b21019d5-de72-4185-9138-a4c57f0d9cf0/Untitled.png)

- ë‹¨ìˆœíˆ  SimpleJobBuilderë¥¼ í†µí•´ì„œëŠ” start, nextë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ 
    - flowë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì—¬ëŸ¬ê°€ì§€ apië¥¼ ì‚¬ìš©í•  ìˆ˜ ì‡ë‹¤.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/b0e02b62-5898-4873-bab2-957cddfadc15/Untitled.png)

- FlowBuilderëŠ” SimpleFlow ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
    - Step, Flow, Deciderë¥¼ í†µí•´ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

flowbuilder > start > on > transitionbulider > íŒ¨í„´ì— í•´ë‹¹í•˜ëŠ” apií˜¸ì¶œ > flowbulder ë°˜í™˜í•˜ì—¬ ë‹¤ì‹œ stepìœ¼ë¡œ ë„˜ì–´ì˜¨ë‹¤.

```java
  @Bean
public Job parentJob(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new JobBuilder("batchJob", jobRepository)
            .incrementer(new RunIdIncrementer())
            .start(step1(jobRepository, transactionManager))
            .on(DEFAILT_ENUM.COMPLETED.getValue()).to(step3(jobRepository, transactionManager))
            .from(step1(jobRepository, transactionManager))
            .on(DEFAILT_ENUM.FAILED.getValue()).to(step2(jobRepository, transactionManager))
            .end()
            .build();
}

@Bean
public Step step1(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new StepBuilder("step1", jobRepository)
            .tasklet(new Tasklet() {
                @Override
                public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {
                    System.out.println("start step1 hello world");
                    return RepeatStatus.FINISHED;
                }
            },transactionManager)
            .build();
}

@Bean
public Step step2(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new StepBuilder("step2", jobRepository)
            .tasklet(new Tasklet() {
                @Override
                public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {
                    System.out.println("start step2 hello world");
                    return RepeatStatus.FINISHED;
                }
            },transactionManager)
            .build();
}

@Bean
public Step step3(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new StepBuilder("step3", jobRepository)
            .tasklet(new Tasklet() {
                @Override
                public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {
                    System.out.println("start step3 hello world");
                    return RepeatStatus.FINISHED;
                }
            },transactionManager)
            .build();
}

```

> job_execution
>
- ì´ì „ì—ëŠ” step1ì´ ì‹¤íŒ¨ê°€ ë‚˜ì˜¤ë©´ Job_Executionì€ failê°€ ë‚˜ì™”ë‹¤. í•˜ì§€ë§Œ flowë¥¼ í†µí•´ step2ë¥¼ ì‹¤í–‰í•˜ë¼ê³  í•˜ì˜€ê¸° ë•Œë¬¸ì— completeedê°€ ë‚˜ì˜´

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/72cfb55a-79e6-4dd8-bd70-14b5d3b2b73b/Untitled.png)

> Step_Execution
>
- Step1 ì‹¤íŒ¨í•˜ë©´  abandoned ì²˜ë¦¬ë˜ê³  step2ê°€ ì‹¤í–‰ëœë‹¤.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/10eba82c-64d4-4056-87ed-96ffd28899d9/Untitled.png)

## start, next()

```java
  @Bean
public Job parentJob(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new JobBuilder("batchJob", jobRepository)
            .start(step1(jobRepository, transactionManager))
// startì— flowê°€ ì˜¤ë©´ jobFlowBuilderê°€ ë°˜í™˜
// stepì´ ì˜¤ë©´ SimpleJobBuilderê°€ ë°˜í™˜

/**
	stepì´ ì˜¤ê³  onì„ ì‘ì„±í•˜ë©´ JobFlowBuildê°€ ë°˜í™˜ë˜ì–´ì„œ FlowJobì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

*/
					.next(step, flow ,decider)
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/38294e18-a404-4d14-b1eb-61904e3f4c1c/Untitled.png)

- ìœ„ì— êµ¬ì„±ì—ì„œ stepì€ flowë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆì–´ ë¶„ê¸°ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.
    - í•˜ì§€ë§Œ stepì¤‘ã…‡ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì „ì²´ jobì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆë‹¤.


## 2. ë°°ì¹˜ ìƒíƒœ ìœ í˜• - Transition

---

### 1. BatchStatus , ExitStatus

- JobExecution, StepExecution ì†ì„±ìœ¼ë¡œ Job, Stepì˜ ìµœì¢… ê²°ê³¼ë¥¼ ì˜ë¯¸í•œë‹¤.

<aside>
ğŸ’¡ BatchStatus , ExitStatus ì°¨ì´ì 

</aside>

- BatchStatus (Job)

ë°°ì¹˜ì˜ í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ìƒíƒœì…ë‹ˆë‹¤. ì¦‰ Jobì˜ ì‹¤í–‰ ì´í›„ ë°°ì¹˜ê°€ ì‹¤í–‰ì¸ì§€ ì¢…ë‹¨ì´ ë˜ì—ˆëŠ”ì§€, ì‹¤íŒ¨ë¥¼ í–ˆëŠ”ì§€ë¥¼ ì˜ë¯¸í•œë‹¤.

- ExitStatus(Step)

Job, Stepì´ ì–´ë–¤ ìƒíƒœë¡œ ì¢…ë£Œë˜ì—ˆëŠ”ì§€ë¥¼ ì˜ë¯¸í•œë‹¤.

[https://www.inflearn.com/questions/865614/batchstatus-ì™€-exitstatus-ì˜-ì°¨ì´ì ì´-ë­”ì§€-ëª¨ë¥´ê² ìŠµë‹ˆë‹¤](https://www.inflearn.com/questions/865614/batchstatus-%EC%99%80-exitstatus-%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90%EC%9D%B4-%EB%AD%94%EC%A7%80-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4)

### SimpleJob

- ë§ˆì§€ë§‰ BatchStatusê°’ì„ Jobì˜ ìµœì¢… BatchStatusê°’ìœ¼ë¡œ ë°˜ì˜
- Stepì´ ì‹¤íŒ¨í•  ê²½ìš° í•´ë‹¹ Stepì´ ë§ˆì§€ë§‰ì´ ëœë‹¤.

### FlowJob

- Flow ë‚´ Stepì˜ ExitStatusê°’ì„ FlowExecutionStatus ì €ì¥í•˜ë©° ë§ˆì§€ë§‰ Flowì˜ FlowExecutionStatusê°’ì„ ìµœì¢… BatchStatusê°€ ëœë‹¤.

### 2. FlowExecutionStatus

- FlowExecutionì˜ ì†ì„±ìœ¼ë¡œ Flow ì‹¤í–‰ í›„ ìµœì¢… ê²°ê³¼ ìƒíƒœê°€ ë¬´ì—‡ì´ì§€ ì •ì˜
- Flow ë‚´ Stepì´ ì‹¤í–‰ë˜ê³  ë‚˜ì„œ ExitStatusê°’ì„ FlowExecutionStatusê°’ìœ¼ë¡œ ì €ì¥í•œë‹¤.
- FlowJobì˜ ë°°ì¹˜ ê²°ê³¼ ìƒíƒœì— ê´€ì—¬í•œë‹¤.

> COMPLETED, STOPPED, FAILED, UNKNOWN
>

### 3. Transition

- Flowë‚´ Stepì˜ ì¡°ê±´ë¶€ ì „í™˜ì„ ì •ì˜í•œë‹¤.
- Jobì˜ API ì„¤ì •ì—ì„œ on ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ TrasnsitionBuilderê°€ ë°˜í™˜ë˜ì–´ Trasnsition Flowë¥¼ êµ¬ì„±
- Stepì˜ ExitStatusê°€ ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´ ì˜ˆì™¸ë¥¼ ë°œìƒí•˜ê³  Jobì€ ì‹¤íŒ¨ëœë‹¤.

### API

<aside>
ğŸ’¡ Flowì˜ íë¦„ì„ ê´€ë¦¬í•˜ëŠ” API

</aside>

1. On(String Pattern)

Stepì˜ ExitStatusì™€ Patternì´ ë§¤ì¹­í•˜ë©´ ë‹¤ìŒì— ì‹¤í–‰í•  Stepì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

- íŠ¹ìˆ˜ë¬¸ì
    - * : 0ê°œ ì´ìƒì˜ ë¬¸ìì™€ ë§¤ì¹­ , ëª¨ë“  ExitStatusì™€ ë§¤ì¹­ëœë‹¤.
    - ? : ì •í™•íˆ 1ê°œì˜ ë¬¸ìì™€ ë§¤ì¹­
        - c*tëŠ” cat, count ë§¤ì¹­ë˜ê³ , c?tëŠ” catì—ë§Œ ë§¤ì¹­ëœë‹¤.

1. to()

ë‹¤ìŒìœ¼ë¡œ ì‹¤í–‰í•  ë‹¨ê³„ë¥¼ ì§€ì •

1. from

ì´ì „ ë‹¨ê³„ì—ì„œ ì •ì˜í•œ Transitionì„ ìƒˆë¡­ê²Œ ì¶”ê°€ ì •ì˜í•¨

<aside>
ğŸ’¡ Jobì„ ì¤‘ë‹¨, ì¢…ë£Œí•˜ëŠ” API                                                                                                                                                                                        - Flowê°€ ì‹¤í–‰ë˜ë©´ FlowExecutionStatusì— ìƒíƒœê°’ì´ ì €ì¥ë˜ê³  Jobì˜ Batch, ExitStatusì— ë°˜ì˜í•œë‹¤.                       Stepì˜ Batch, ExitStatusì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  Jobì˜ ìƒíƒœë§Œ ë³€ê²½í•œë‹¤.

</aside>

1. Stop

FlowExecutionStatus, BatchStatus, ExitStatusë¥¼ STOPPEDë¡œ ì¢…ë£Œë¥¼ ì‹œí‚¨ë‹¤.

1. fail

FlowExecutionStatus, BatchStatus, ExitStatusë¥¼ FAILEDë¡œ ì¢…ë£Œë¥¼ ì‹œí‚¨ë‹¤.

6.end

FlowExecutionStatus, BatchStatus, ExitStatusë¥¼ COMPLETEDë¡œ ì¢…ë£Œë¥¼ ì‹œí‚¨ë‹¤.

- Stepì˜ EXitStatusê°€ FAILEDì´ë”ë¼ë„ JOBì˜ BATCHSTATUSê°€ COMPLETEDë¡œ ì¢…ë£Œ
- JOBì˜ ì¬ì‹œì‘ì„ ë¶ˆê°€ëŠ¥í•˜ê²Œ ë§Œë“ ë‹¤.

1. stopAndRestart

stopê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ íŠ¹ì • stepì‘ì—…ì„ ì¤‘ë‹¨í•˜ê³  ì´ì „ stepì€ completedë¡œ ì €ì¥ì„ í•˜ê³  íŠ¹ì • stepì„ STOPPED ì €ì¥

jobì´ ë‹¤ì‹œ ì‹¤í–‰í•  ë•Œ stepì„ restartì¸ìë¡œ ë„˜ê¸°ë©´ ì´ì „ì— completed ìŠ¤íƒ­ì„ ê±´ë„ˆë›°ê³  STOPPEDë¶€í„° ì‹œì‘í•œë‹¤.

## 3. ExitStatus

---

- Job, Stepì´ ì–´ë–¤ ìƒíƒœë¡œ ì¢…ë£Œê°€ ë˜ì—ˆëŠ”ì§€ ì˜ë¯¸
- StepExecutionListenerì˜ afterStep ë©”ì„œë“œì˜ Custom exitCode ìƒì„± í›„ ìƒˆë¡œìš´ ExitStatus ë°˜í™˜

```java

@Bean
public Job flowJob(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new JobBuilder("batchJob", jobRepository)
            .incrementer(new RunIdIncrementer())
            .start(step1(jobRepository, transactionManager))
            .on(DEFAILT_ENUM.FAILED.getValue())
            .to(step2(jobRepository, transactionManager))
            .on("CUSTOM_EXIT_STATUS_CODE")
            .stop()
            .end()
            .build();
}

@Bean
public Step step1(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new StepBuilder("step1", jobRepository)
            .tasklet(new Tasklet() {
                @Override
                public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {
                    contribution.setExitStatus(ExitStatus.FAILED);
                    System.out.println("start step1 hello world");
                    return RepeatStatus.FINISHED;
                }
            }, transactionManager)
            .build();
}

@Bean
public Step step2(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new StepBuilder("step2", jobRepository)
            .tasklet(new Tasklet() {
                @Override
                public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {
                    System.out.println("start step2 hello world");
                    return RepeatStatus.FINISHED;
                }
            }, transactionManager)
            .build();
}

@Bean
public Step step3(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new StepBuilder("step3", jobRepository)
            .tasklet(new Tasklet() {
                @Override
                public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {
                    System.out.println("start step3 hello world");
                    return RepeatStatus.FINISHED;
                }
            }, transactionManager)
            .build();
}
```

**`BATCH_JOB_EXECUTION` ì„ ì‚´í´ë³´ë©´ statusê°€ ëª¨ë‘ FAILEDê°€ ë‚˜ì˜¨ë‹¤.**

- ì´ë ‡ê²Œ ë‚˜ì˜¨ ì´ìœ ëŠ” step2ê°€ `CUSTOM_EXIT_STATUS_CODE` ì¸ë° successê°€ ë˜ê¸° ë•Œë¬¸ì— stopì„ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - ì´ë ‡ê²Œ flowë’¤ì— ì‹¤íŒ¨ê°€ ë˜ê³  .end()ë¥¼ í•˜ë©´ ìŠ¤í”„ë§ ìì²´ì—ì„œ FAILEDë¥¼ JOB_Executionì— FAILEDë¡œ ë§Œë“¬

<aside>
ğŸ’¡ JOB_EXECUTIONì€ ë§ˆì§€ë§‰ ìƒíƒœì— ëŒ€í•´ì„œ ì €ì¥ì„ í•˜ëŠ”ë° STEP2ëŠ” ì„±ê³µìœ¼ë¡œ ë‚˜ì˜¨ë‹¤.

</aside>

```java
[
  {
    "STATUS": "FAILED",
    "EXIT_CODE": "FAILED"
  }
]
```

**`BATCH_STEP_EXECUTION`**

```java
[
  {
    "STATUS": "COMPLETED",
    "EXIT_CODE": "FAILED"
  },
  {
    "STATUS": "COMPLETED",
    "EXIT_CODE": "COMPLETED"
  }
]
```

- í˜„ì¬ step1ì€ FAILì´ ë‚˜ì˜¤ê³  STEP2ëŠ” COMPLETEDê°€ ë‚˜ì˜¨ë‹¤.
- ê¸°ì¡´ì— ìƒê°ì€ step2ê°€ customì´ ì•„ë‹ˆë‹ˆê¹ failì´ ë‚˜ì˜¨ë‹¤ê³  ìƒê°í–ˆì§€ë§Œ step2ì˜ ì½”ë“œëŠ” onì„ ì‹¤í–‰í•˜ê¸° ì´ì „ì— ìˆ˜í–‰í•œë‹¤.

## 4. JobExecutionDecider

---

- ExitStatusë¥¼ ì¡°ì‘í•˜ê±°ë‚˜ StepExecutionListenerë¥¼ ë“±ë¡í•  í•„ìš” ì—†ì´ Transition ì²˜ë¦¬ë¥¼ ìœ„í•œ ì „ìš© í´ë˜ìŠ¤
- Stepê³¼ Transition ì—­í™œì„ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ì„¤ì •
- ExitStatusê°€ ì•„ë‹Œ JobExecutionDeciderì˜ FlowExecutionStatus ìƒíƒœê°’ì„ ìƒˆë¡­ê²Œ ì„¤ì •í•´ì„œ ë°˜í™˜í•¨

# 5. FlowJob

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/697992fe-840f-4689-a5a1-9d45cec7a9f2/Untitled.png)

- FlowBuilderì— Stepì„ ì €ì¥í•˜ì—¬ SimpleFlow ê°ì²´ë¥¼ ë§Œë“ ë‹¤.

- ìŠ¤í”„ë§ ë°°ì¹˜ì—ì„œ ì œê³µí•˜ëŠ” Flowì˜ êµ¬í˜„ì²´ë¡œì„œ ê° ìš”ì†Œ(Step, Flow , Decider)ë¥¼ ë‹´ê³  ìˆëŠ” Stateë¥¼ ì‹¤í–‰
- FlowBuilderë¥¼ ì‚¬ìš©í•´ì„œ ìƒì„±í•˜ë©° Transitionê³¼ ì¡°í•©í•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ Flow ë° ì¤‘ì²© Flowë¥¼ ë§Œë“¤ì–´ Jobì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.

  ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/439b918b-d2d3-4236-b5b9-be5a41012e8a/Untitled.png)


> JobBuilder > FlowJobBuilder > FlowBuilder > SimpleFlow
>

```java
@Bean
public Job job(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new JobBuilder("batchJob", jobRepository)
            .incrementer(new RunIdIncrementer())
            .start(flow1(jobRepository, transactionManager)) // Flowë¥¼ ì •ì˜í•œë‹¤.
            .on(DEFAILT_ENUM.COMPLETED.getValue()) // Transition
            .to(flow2(jobRepository, transactionManager))
            .from(flow1(jobRepository, transactionManager))
            .on(DEFAILT_ENUM.FAILED.getValue())
            .to(flow3(jobRepository, transactionManager))
            .end() // SimpleFLow ê°ì²´ ìƒì„±
            .build(); // FlowJob ìƒì„±
}

```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/c3c8650c-e998-4ce5-80a1-141c4f58564b/Untitled.png)

<aside>
ğŸ’¡ SimpleFlow íë¦„

</aside>

1. FlowBuilderëŠ” ê° ë‹¨ê³„(Step, Flow, Decider)ë¥¼ í†µí•´ì„œ StateTransitionì„ ë§Œë“ ë‹¤.
2. Nê°œì˜ StateTransitionì´ SimpleFlowì˜ List í˜•íƒœë¡œ ì €ì¥ë˜ì–´ handle ë©”ì„œë“œ ê° ë‹¨ê³„ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.
3.  ì‹¤í–‰ í›„ FlowExecutionStatus ë°˜í™˜
4. on Patternê³¼ ë§¤ì¹­ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê³  ë§ˆì§€ë§‰ì— FlowJobì„ ë°˜í™˜í•œë‹¤.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/d416938a-b825-44d7-9e0a-0caef2824ea1/Untitled.png)

### FlowStep

- Step ë‚´ì— Flowë¥¼ í• ë‹¹í•˜ì—¬ ì‹¤í–‰ì‹œí‚¤ëŠ” êµ¬ì¡°
- flowStepì˜ BatchStatusì™€ ExitStatusê°€ Flowì˜ ìµœì¢… ìƒíƒœê°’ì´ ê²°ì •ëœë‹¤.

# 6. @JobScope / @StepScope

---

### 1. Scope

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ë¹ˆì´ ê´€ë¦¬ë˜ëŠ” ë²”ìœ„
    - Jobê³¼ Stepì˜ ë¹ˆ ìƒì„±ê³¼ ì‹¤í–‰ì— ê´€ì—¬í•˜ëŠ” ìŠ¤ì½”í”„
    - í”„ë¡ì‹œ ëª¨ë“œë¥¼ defaultë¡œ í•˜ëŠ” ìŠ¤ì½”ë“œ
      â€¢ @Scope(value = "job", proxyMode = ScopedProxyMode.TARGET_CLASS)
    - ìŠ¤ì½”í”„ë¥¼ ì„ ì–¸í•˜ë©´ ë¹ˆ ìƒì„±ì´ spring êµ¬ë™ì‹œì ì´ ì•„ë‹Œ ë¹ˆ ì‹¤í–‰ì‹œì ì— ì´ë£¨ì–´ì§„ë‹¤

    ```java
    # ì´ë¥¼ í†µí•˜ì—¬ ë™ì ìœ¼ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
    # í”„ë¡ì‹œ ëª¨ë“œë¡œ ë¹ˆì´ ì„ ì–¸ë˜ê¸° ë•Œë¬¸ì— êµ¬ë™ ì‹œì ì— ê°ì²´ê°€ ìƒì„±ë˜ì–´ ì‹¤í–‰ ì‹œì ì— ë¹ˆì„ í˜¸ì¶œí•´ ì¤€ë‹¤.
    # ë³‘ë ¬ì²˜ë¦¬ ì‹œ ê° ìŠ¤ë ˆë“œ ë§ˆë‹¤ ìƒì„±ëœ ìŠ¤í”„ë§ ë¹ˆì´ í• ë‹¹ë˜ì–´ ìŠ¤ë ˆë“œì— ì•ˆì „í•˜ê²Œ ì‹¤í–‰í•œë‹¤.
     @Value("#{jobParameters[íŒŒë¼ë¯¸í„°ëª…]}"), @Value("#{jobExecutionContext[íŒŒë¼ë¯¸í„°ëª…]â€}), @Value("#{stepExecutionContext[íŒŒë¼ë¯¸í„°ëª…]â€})
    
    ```

    - @StepScope

### @JobScope

- Step ì„ ì–¸ë¬¸ì— ì •ì˜í•œë‹¤.
- @Value : jobParameter, jobExecutionContext ë§Œ ì‚¬ìš©ê°€ëŠ¥

### @StepScope

- Taskletì´ë‚˜ ItemReader, ItemWriter, ItemProcessor ì„ ì–¸ë¬¸ì— ì •ì˜í•œë‹¤
- @Value : jobParameter, jobExecutionContext, stepExecutionContext ì‚¬ìš©ê°€ëŠ¥

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/1cd40f6b-4747-4bba-a656-846694fd5c31/b8e1cfa0-0600-495e-b8ae-8326b1ad0eb8/Untitled.png)
