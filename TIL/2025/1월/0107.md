# ğŸ“ TIL (Today I Learned)

---

## 1. ì˜¤ëŠ˜ ë§Œë‚¬ë˜ ì´ìŠˆ

### 1-1. Spring Batch DeadLock

[ ë°°ê²½ ]

- Jenkinsì—ì„œ Batch Jobì„ Nê°œ ëŒì•„ê°€ë©´ì„œ í•˜ë‚˜ì˜ í…Œì´ë¸”ì— write I/O ì‘ì—…ì„ ì²˜ë¦¬í•˜ë©´ì„œ DeadLockì´ ë°œìƒí–ˆë‹¤.
- ê²°êµ­ ë¬¸ì œëŠ” MySQLì—ì„œ Update ì‹œ Row Level X-Lock ê²½í•©ìœ¼ë¡œ ì¸í•œ ë°ë“œë½ìœ¼ë¡œ ë°œìƒì„ í•˜ì˜€ë‹¤.
```text
------------------------
LATEST DETECTED DEADLOCK
------------------------
2025-01-07 15:31:48 
*** (1) TRANSACTION:
TRANSACTION 448043591, ACTIVE 45 sec fetching rows
mysql tables in use 1, locked 1

2025-01-07 15:31:49 [INFO ] [] [] Commit failed while step execution data was already updated. Reverting to old version.
org.springframework.dao.DeadlockLoserDataAccessException:  (batch index #5) failed. 4 prior sub executor(s) completed successfully, but will be rolled back. Cause: java.sql.BatchUpdateException: Deadlock found when trying to get lock; try restarting transaction
; Deadlock found when trying to get lock; try restarting transaction
at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:278)
at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107)
at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
at org.mybatis.spring.SqlSessionUtils$SqlSessionSynchronization.beforeCommit(SqlSessionUtils.java:293)
at org.springframework.transaction.support.TransactionSynchronizationUtils.triggerBeforeCommit(TransactionSynchronizationUtils.java:97)
at org.springframework.transaction.support.AbstractPlatformTransactionManager.triggerBeforeCommit(AbstractPlatformTransactionManager.java:986)
at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:775)
at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:758)
at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:152)
at org.springframework.batch.core.step.tasklet.TaskletStep$2.doInChunkContext(TaskletStep.java:255)
at org.springframework.batch.core.scope.context.StepContextRepeatCallback.doInIteration(StepContextRepeatCallback.java:82)
```



## 2.  ì˜¤ëŠ˜ í•™ìŠµ ë‚´ìš©